<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Reporting Dashboard - GIBSYSNET</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
        }
        
        .sidebar {
            transition: all 0.3s ease;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar.collapsed {
            width: 70px !important;
        }
        
        .sidebar.collapsed .menu-text,
        .sidebar.collapsed .logo-text {
            display: none;
        }
        
        .sidebar.collapsed .logo-icon {
            margin: 0 auto;
        }
        
        .content-area {
            transition: all 0.3s ease;
            height: 100vh;
            overflow-y: auto;
        }
        
        .glass-card {
            transition: all 0.3s ease;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-submitted { background: #dbeafe; color: #1e40af; }
        .status-review { background: #f0f9ff; color: #0369a1; }
        .status-approved { background: #dcfce7; color: #166534; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .status-processing { background: #f3e8ff; color: #6b21a8; }
        .status-paid { background: #d1fae5; color: #065f46; }
        .status-closed { background: #f1f5f9; color: #475569; }
        
        .priority-badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .priority-high { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .priority-medium { background: #fffbeb; color: #d97706; border: 1px solid #fde68a; }
        .priority-low { background: #f0f9ff; color: #0369a1; border: 1px solid #bae6fd; }
        
        .type-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-color);
        }
        
        .tab-button {
            padding: 10px 20px;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .search-box {
            transition: all 0.3s ease;
        }
        
        .search-box:focus-within {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Claim type colors */
        .claim-type-health { background: linear-gradient(135deg, #10b981, #059669); }
        .claim-type-auto { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .claim-type-property { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .claim-type-life { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .claim-type-travel { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .claim-type-liability { background: linear-gradient(135deg, #ec4899, #db2777); }
        
        /* Role colors for sidebar */
        .role-superadmin { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .role-admin { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .role-manager { background: linear-gradient(135deg, #10b981, #059669); }
        .role-broker { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .role-user { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .role-compliance { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        
        /* Stat Card Colors */
        .stat-card-blue { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .stat-card-green { background: linear-gradient(135deg, #10b981 0%, #047857 100%); }
        .stat-card-yellow { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .stat-card-purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .stat-card-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .stat-card-cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .stat-card-pink { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        
        /* ============================================== */
        /* ULTRA MODERN QUICK ACTIONS STYLES - PRESERVED */
        /* ============================================== */
        
        /* Action Card - Updated to match theme */
        .action-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            height: 100%;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }
        
        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--action-color, #667eea) 0%,
                rgba(102, 126, 234, 0.5) 100%);
        }
        
        .quick-action-modern:hover .action-card {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Color variations based on action - PRESERVED */
        .quick-action-modern[data-action="policies"] .action-card::before {
            --action-color: #3b82f6;
        }
        
        .quick-action-modern[data-action="clients"] .action-card::before {
            --action-color: #10b981;
        }
        
        .quick-action-modern[data-action="claims"] .action-card::before {
            --action-color: #f59e0b;
        }
        
        .quick-action-modern[data-action="financial"] .action-card::before {
            --action-color: #8b5cf6;
        }
        
        .quick-action-modern[data-action="performance"] .action-card::before {
            --action-color: #ec4899;
        }
        
        .quick-action-modern[data-action="alerts"] .action-card::before {
            --action-color: #ef4444;
        }
        
        .action-icon-wrapper {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .quick-action-modern[data-action="policies"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2));
            color: #3b82f6;
        }
        
        .quick-action-modern[data-action="clients"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.2));
            color: #10b981;
        }
        
        .quick-action-modern[data-action="claims"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.2));
            color: #f59e0b;
        }
        
        .quick-action-modern[data-action="financial"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.2));
            color: #8b5cf6;
        }
        
        .quick-action-modern[data-action="performance"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(236, 72, 153, 0.2));
            color: #ec4899;
        }
        
        .quick-action-modern[data-action="alerts"] .action-icon-wrapper {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.2));
            color: #ef4444;
        }
        
        .action-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            animation: badge-pulse 2s infinite;
        }
        
        .action-badge.urgent {
            background: #ef4444;
            animation: urgent-pulse 1.5s infinite;
        }
        
        .action-badge.alert {
            background: #f59e0b;
        }
        
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .quick-action-modern {
            display: block;
            text-decoration: none;
            color: inherit;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .quick-action-modern:hover {
            transform: translateY(-5px);
        }
        
        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes urgent-pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.2); 
                box-shadow: 0 0 0 5px rgba(239, 68, 68, 0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar bg-white shadow-lg w-64 flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b flex items-center space-x-3">
                <div class="logo-icon w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-network text-white text-xl"></i>
                </div>
                <div class="logo-text">
                    <h1 class="text-xl font-bold text-gray-800">GIBSYSNET</h1>
                    <p class="text-xs text-gray-500">Analytics Dashboard</p>
                </div>
            </div>
            
            <!-- User Profile -->
            <div class="p-4 border-b">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center role-superadmin" id="userAvatar">
                        <span class="text-white font-bold" id="userInitials">A</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800" id="userName">Administrator</h3>
                        <p class="text-xs text-gray-500" id="userRole">Super Admin</p>
                        <p class="text-xs text-gray-400" id="userEmail">Loading...</p>
                    </div>
                </div>
            </div>
            
            <!-- Main Navigation -->
            <nav class="flex-1 p-4">
                <ul class="space-y-1">
                    <!-- Dashboard -->
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-3 rounded-lg bg-blue-50 text-blue-600 border-l-4 border-blue-600">
                            <i class="fas fa-home w-5 text-center"></i>
                            <span class="menu-text font-semibold">Dashboard</span>
                        </a>
                    </li>
                    
                    <!-- Policies -->
                    <li>
                        <a href="policies-report.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-file-contract w-5 text-center"></i>
                            <span class="menu-text">Policy Reports</span>
                        </a>
                    </li>
                    
                    <!-- Clients -->
                    <li>
                        <a href="clients-report.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-users w-5 text-center"></i>
                            <span class="menu-text">Client Reports</span>
                        </a>
                    </li>
                    
                    <!-- Claims -->
                    <li>
                        <a href="claims-report.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-clipboard-check w-5 text-center"></i>
                            <span class="menu-text">Claims Reports</span>
                        </a>
                    </li>
                    
                    <!-- Financial -->
                    <li>
                        <a href="financial-report.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-chart-line w-5 text-center"></i>
                            <span class="menu-text">Financial Reports</span>
                        </a>
                    </li>
                    
                    <!-- Performance -->
                    <li>
                        <a href="performance-report.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-trophy w-5 text-center"></i>
                            <span class="menu-text">Performance</span>
                        </a>
                    </li>
                    
                    <!-- Analytics -->
                    <li>
                        <a href="analytics.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-chart-bar w-5 text-center"></i>
                            <span class="menu-text">Analytics</span>
                        </a>
                    </li>
                    
                    <!-- Divider -->
                    <li class="pt-4">
                        <div class="text-xs uppercase text-gray-400 font-semibold px-3 mb-2">Settings</div>
                    </li>
                    
                    <!-- Profile -->
                    <li>
                        <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-user-cog w-5 text-center"></i>
                            <span class="menu-text">Profile</span>
                        </a>
                    </li>
                    
                    <!-- Settings -->
                    <li>
                        <a href="settings.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                            <i class="fas fa-cog w-5 text-center"></i>
                            <span class="menu-text">Settings</span>
                        </a>
                    </li>
                    
                    <!-- Back to Main Dashboard -->
                    <li>
                        <a href="../dashboard/dashboard-admin.html" class="flex items-center space-x-3 p-3 rounded-lg text-blue-600 hover:bg-blue-50 transition">
                            <i class="fas fa-arrow-left w-5 text-center"></i>
                            <span class="menu-text">Back to Dashboard</span>
                        </a>
                    </li>
                    
                    <!-- Logout -->
                    <li>
                        <a href="../login.html" class="flex items-center space-x-3 p-3 rounded-lg text-red-600 hover:bg-red-50 transition">
                            <i class="fas fa-sign-out-alt w-5 text-center"></i>
                            <span class="menu-text">Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Toggle Sidebar -->
            <div class="p-4 border-t">
                <button onclick="toggleSidebar()" class="w-full flex items-center justify-center space-x-2 p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition">
                    <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
                    <span class="menu-text text-sm">Collapse</span>
                </button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="content-area flex-1 flex flex-col">
            <!-- Top Header -->
            <header class="bg-white shadow-sm border-b px-6 py-4">
                <div class="flex items-center justify-between">
                    <!-- Left: Breadcrumb & Title -->
                    <div>
                        <nav class="flex text-sm text-gray-500 mb-1">
                            <a href="../dashboard/dashboard-admin.html" class="hover:text-blue-600">Dashboard</a>
                            <span class="mx-2">/</span>
                            <span class="text-gray-700 font-medium">Analytics Dashboard</span>
                        </nav>
                        <h1 class="text-2xl font-bold text-gray-800">Advanced Reporting Dashboard</h1>
                        <p class="text-gray-600" id="welcomeMessage">Real-time insights and comprehensive reporting</p>
                    </div>
                    
                    <!-- Right: Actions & Search -->
                    <div class="flex items-center space-x-4">
                        <!-- Search -->
                        <div class="relative">
                            <div class="search-box flex items-center bg-gray-100 rounded-lg px-4 py-2 w-64">
                                <i class="fas fa-search text-gray-400 mr-2"></i>
                                <input type="text" id="searchReports" placeholder="Search reports..." 
                                       class="bg-transparent outline-none w-full text-sm">
                            </div>
                        </div>
                        
                        <!-- Notifications -->
                        <button onclick="openNotifications()" class="relative p-2 rounded-full hover:bg-gray-100">
                            <i class="fas fa-bell text-gray-600"></i>
                            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full" id="notificationBadge">3</span>
                        </button>
                        
                        <!-- Refresh Button -->
                        <button onclick="refreshDashboard()" 
                                class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:shadow-lg transition">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                        
                        <!-- Back to Dashboard Button -->
                        <a href="../dashboard/dashboard-admin.html" 
                           class="border border-blue-600 text-blue-600 px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-blue-50 transition">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Dashboard</span>
                        </a>
                                               
                        <!-- Export Menu -->
                        <div class="relative">
                            <button onclick="toggleExportMenu()" 
                                    class="border border-blue-600 text-blue-600 px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-blue-50 transition">
                                <i class="fas fa-download"></i>
                                <span>Export</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div id="exportMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border py-2 z-50 hidden">
                                <button onclick="exportDashboard()" class="w-full text-left px-4 py-2 hover:bg-gray-100">
                                    <i class="fas fa-file-archive text-blue-600 mr-2"></i>
                                    Export All Reports
                                </button>
                                <button onclick="exportAsPDF()" class="w-full text-left px-4 py-2 hover:bg-gray-100">
                                    <i class="fas fa-file-pdf text-red-600 mr-2"></i>
                                    Export as PDF
                                </button>
                                <button onclick="exportAsExcel()" class="w-full text-left px-4 py-2 hover:bg-gray-100">
                                    <i class="fas fa-file-excel text-green-600 mr-2"></i>
                                    Export as Excel
                                </button>
                                <button onclick="scheduleReport()" class="w-full text-left px-4 py-2 hover:bg-gray-100">
                                    <i class="fas fa-calendar-alt text-purple-600 mr-2"></i>
                                    Schedule Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs Navigation -->
                <div class="mt-6 flex space-x-1 border-b overflow-x-auto">
                    <button class="tab-button active whitespace-nowrap" data-tab="overview" onclick="switchTab('overview')">Overview</button>
                    <button class="tab-button whitespace-nowrap" data-tab="policies" onclick="switchTab('policies')">Policies</button>
                    <button class="tab-button whitespace-nowrap" data-tab="clients" onclick="switchTab('clients')">Clients</button>
                    <button class="tab-button whitespace-nowrap" data-tab="claims" onclick="switchTab('claims')">Claims</button>
                    <button class="tab-button whitespace-nowrap" data-tab="financial" onclick="switchTab('financial')">Financial</button>
                    <button class="tab-button whitespace-nowrap" data-tab="performance" onclick="switchTab('performance')">Performance</button>
                </div>
            </header>
            
            <!-- Main Content -->
            <main class="flex-1 p-6">
                <!-- Dynamic Stats Cards Based on Active Tab -->
                <div id="statsCardsContainer" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <!-- Stats cards will be dynamically loaded here based on active tab -->
                </div>
                
                <!-- Charts & Analytics -->
                <div id="chartsContainer" class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <!-- Charts will be dynamically loaded here based on active tab -->
                </div>
                
                <!-- Quick Actions & Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <!-- Quick Actions -->
                    <div class="col-span-2">
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-bolt text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-bold text-gray-800 mb-0">Quick Actions</h5>
                                        <small class="text-gray-600">Instant access to essential tools</small>
                                    </div>
                                </div>
                                <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                    <i class="fas fa-fire me-1"></i> Hot
                                </span>
                            </div>
                            
                            <div class="quick-actions-grid">
                                <!-- Policy Reports -->
                                <a href="policies-report.html" class="quick-action-modern" data-action="policies">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container relative">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-file-contract"></i>
                                                </div>
                                                <span class="action-badge">3</span>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-gray-600 text-xs">12 today</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Policy Reports</h6>
                                        <p class="text-gray-600 text-sm mb-3">Detailed policy analysis & insights</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">Updated 5 min ago</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-arrow-right text-blue-600"></i>
                                        </div>
                                    </div>
                                </a>
                                
                                <!-- Client Reports -->
                                <a href="clients-report.html" class="quick-action-modern" data-action="clients">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-users"></i>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-green-600 text-xs font-medium">+8% growth</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Client Reports</h6>
                                        <p class="text-gray-600 text-sm mb-3">Client demographics & behavior</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">189 active clients</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-arrow-right text-green-600"></i>
                                        </div>
                                    </div>
                                </a>
                                
                                <!-- Claims Reports -->
                                <a href="claims-report.html" class="quick-action-modern" data-action="claims">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container relative">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </div>
                                                <span class="action-badge urgent">5</span>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-red-600 text-xs font-medium">High priority</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Claims Reports</h6>
                                        <p class="text-gray-600 text-sm mb-3">Claims tracking & management</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">23 pending claims</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-arrow-right text-red-600"></i>
                                        </div>
                                    </div>
                                </a>
                                
                                <!-- Financial Reports -->
                                <a href="financial-report.html" class="quick-action-modern" data-action="financial">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-chart-line"></i>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-purple-600 text-xs font-medium">$1.8M revenue</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Financial Reports</h6>
                                        <p class="text-gray-600 text-sm mb-3">Revenue & expense analytics</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">+15% this month</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-arrow-right text-purple-600"></i>
                                        </div>
                                    </div>
                                </a>
                                
                                <!-- Performance -->
                                <div class="quick-action-modern" onclick="generatePerformanceReport()" data-action="performance">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-trophy"></i>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-pink-600 text-xs font-medium">Top performer</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Performance</h6>
                                        <p class="text-gray-600 text-sm mb-3">KPI dashboard & metrics</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-pink-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">98% satisfaction</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-rocket text-pink-600"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Alerts -->
                                <div class="quick-action-modern" onclick="openAlertCenter()" data-action="alerts">
                                    <div class="action-card">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="action-icon-container relative">
                                                <div class="action-icon-wrapper">
                                                    <i class="fas fa-bell"></i>
                                                </div>
                                                <span class="action-badge alert">2</span>
                                            </div>
                                            <div class="text-right">
                                                <small class="text-orange-600 text-xs font-medium">New alerts</small>
                                            </div>
                                        </div>
                                        <h6 class="font-bold text-gray-800 mb-1">Alerts Center</h6>
                                        <p class="text-gray-600 text-sm mb-3">System alerts & notifications</p>
                                        <div class="flex justify-between items-center">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                                            <small class="text-gray-500 text-xs">Requires attention</small>
                                        </div>
                                        <div class="absolute bottom-4 right-4 opacity-0 transition-opacity quick-action-modern:hover:opacity-100">
                                            <i class="fas fa-arrow-right text-orange-600"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Activity</h3>
                        <div class="space-y-4" id="activityList">
                            <!-- Activities will be loaded here -->
                        </div>
                        <div class="mt-4 text-center">
                            <button onclick="loadMoreActivities()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                View all activities →
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Reports -->
                <div class="bg-white rounded-xl shadow overflow-hidden mb-8">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Advanced Reports</h2>
                                <p class="text-gray-600">Comprehensive analytics and insights</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Risk Analysis -->
                            <div class="border rounded-xl p-6 hover:shadow-lg transition">
                                <div class="mb-4">
                                    <i class="fas fa-shield-alt fa-3x text-blue-600"></i>
                                </div>
                                <h5 class="font-bold text-gray-800 mb-2">Risk Analysis</h5>
                                <p class="text-gray-600 mb-4">Comprehensive risk assessment and mitigation reports</p>
                                <button onclick="openRiskAnalysis()" class="text-blue-600 hover:text-blue-800 font-medium">
                                    Generate Report →
                                </button>
                            </div>
                            
                            <!-- Performance Metrics -->
                            <div class="border rounded-xl p-6 hover:shadow-lg transition">
                                <div class="mb-4">
                                    <i class="fas fa-chart-network fa-3x text-green-600"></i>
                                </div>
                                <h5 class="font-bold text-gray-800 mb-2">Performance Metrics</h5>
                                <p class="text-gray-600 mb-4">KPI tracking and performance analytics</p>
                                <button onclick="openPerformanceMetrics()" class="text-green-600 hover:text-green-800 font-medium">
                                    View Metrics →
                                </button>
                            </div>
                            
                            <!-- Predictive Insights -->
                            <div class="border rounded-xl p-6 hover:shadow-lg transition">
                                <div class="mb-4">
                                    <i class="fas fa-lightbulb fa-3x text-yellow-600"></i>
                                </div>
                                <h5 class="font-bold text-gray-800 mb-2">Predictive Insights</h5>
                                <p class="text-gray-600 mb-4">AI-powered predictions and recommendations</p>
                                <button onclick="openPredictiveInsights()" class="text-yellow-600 hover:text-yellow-800 font-medium">
                                    Get Insights →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <!-- Database Status -->
                    <div class="bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">System Status</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600">Database</span>
                                    <span class="text-sm font-medium">85%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600">API Response</span>
                                    <span class="text-sm font-medium">98%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 98%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <p class="text-sm text-gray-600">Last updated: <span id="lastUpdateTime">Just now</span></p>
                        </div>
                    </div>
                    
                    <!-- Time Filter -->
                    <div class="bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Data Timeframe</h3>
                        <div class="space-y-3">
                            <div class="flex space-x-2">
                                <button onclick="setTimeFilter('today')" class="flex-1 py-2 border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition text-center filter-btn active">
                                    Today
                                </button>
                                <button onclick="setTimeFilter('week')" class="flex-1 py-2 border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition text-center filter-btn">
                                    This Week
                                </button>
                                <button onclick="setTimeFilter('month')" class="flex-1 py-2 border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition text-center filter-btn">
                                    This Month
                                </button>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="setTimeFilter('quarter')" class="flex-1 py-2 border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition text-center filter-btn">
                                    This Quarter
                                </button>
                                <button onclick="setTimeFilter('year')" class="flex-1 py-2 border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition text-center filter-btn">
                                    This Year
                                </button>
                            </div>
                        </div>
                        <div class="mt-6">
                            <p class="text-sm text-gray-600">Current filter: <span class="font-medium" id="currentFilterDisplay">This Month</span></p>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="bg-white border-t px-6 py-4">
                <div class="flex justify-between items-center text-sm text-gray-500">
                    <div>
                        <span>GIBSYSNET Reporting Dashboard v2.0</span>
                        <span class="mx-2">•</span>
                        <span id="currentDate">Loading date...</span>
                        <span class="mx-2">•</span>
                        <span>Data refreshes automatically every 5 minutes</span>
                    </div>
                    <div>
                        <span id="lastSync">Last synced: Just now</span>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // ==============================================
        // API CONFIGURATION
        // ==============================================
        
        const API_BASE_URL = 'http://localhost:3000'; // Default for JSON Server
        
        const API_ENDPOINTS = {
            dashboard: `${API_BASE_URL}/dashboard`,
            statistics: `${API_BASE_URL}/statistics`,
            activities: `${API_BASE_URL}/activities`,
            charts: `${API_BASE_URL}/charts`,
            policies: `${API_BASE_URL}/policies`,
            clients: `${API_BASE_URL}/clients`,
            claims: `${API_BASE_URL}/claims`,
            financial: `${API_BASE_URL}/financial`,
            performance: `${API_BASE_URL}/performance`
        };
        
        // ==============================================
        // GLOBAL VARIABLES
        // ==============================================
        let charts = {};
        let currentTimeFilter = 'month';
        let autoRefreshInterval;
        let currentUser = {};
        let currentTab = 'overview';
        let tabData = {
            overview: {},
            policies: {},
            clients: {},
            claims: {},
            financial: {},
            performance: {}
        };
        
        // ==============================================
        // INITIALIZATION
        // ==============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard initialization started...');
            
            // Load user data
            loadUserData();
            
            // Check authentication
            if (!checkAuth()) return;
            
            // Initialize components
            initializeDateTime();
            
            // Initialize tab system
            initializeTabs();
            
            // Load initial data for overview tab
            loadTabData('overview');
            loadActivities();
            
            // Setup auto-refresh
            setupAutoRefresh();
            
            // Setup event listeners
            setupEventListeners();
            
            console.log('Dashboard initialized successfully');
        });
        
        // ==============================================
        // TAB MANAGEMENT SYSTEM
        // ==============================================
        
        function initializeTabs() {
            // Set overview as default active tab
            switchTab('overview');
        }
        
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });
            
            // Update current tab
            currentTab = tabName;
            
            // Update page title based on tab
            updatePageTitle(tabName);
            
            // Load data for the selected tab
            loadTabData(tabName);
        }
        
        function updatePageTitle(tabName) {
            const pageTitle = document.getElementById('pageTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');
            
            const titles = {
                overview: {
                    title: 'Advanced Analytics Dashboard',
                    subtitle: 'Comprehensive overview and analysis of insurance portfolio'
                },
                policies: {
                    title: 'Policies Analytics & Reporting',
                    subtitle: 'Comprehensive overview and analysis of insurance policies portfolio'
                },
                clients: {
                    title: 'Clients Analytics & Reporting',
                    subtitle: 'Comprehensive analysis of client demographics and behavior'
                },
                claims: {
                    title: 'Claims Analytics & Reporting',
                    subtitle: 'Detailed analysis of insurance claims and processing'
                },
                financial: {
                    title: 'Financial Analytics & Reporting',
                    subtitle: 'Comprehensive financial analysis and revenue tracking'
                },
                performance: {
                    title: 'Performance Analytics & Reporting',
                    subtitle: 'KPI tracking and performance metrics analysis'
                }
            };
            
            const tabInfo = titles[tabName] || titles.overview;
            
            if (pageTitle) pageTitle.textContent = tabInfo.title;
            if (pageSubtitle) pageSubtitle.textContent = tabInfo.subtitle;
        }
        
        async function loadTabData(tabName) {
            showLoading();
            
            try {
                // Load data based on tab
                switch(tabName) {
                    case 'overview':
                        await loadOverviewData();
                        break;
                    case 'policies':
                        await loadPoliciesData();
                        break;
                    case 'clients':
                        await loadClientsData();
                        break;
                    case 'claims':
                        await loadClaimsData();
                        break;
                    case 'financial':
                        await loadFinancialData();
                        break;
                    case 'performance':
                        await loadPerformanceData();
                        break;
                }
                
                // Update UI for the tab
                updateTabUI(tabName);
                
            } catch (error) {
                console.error(`Error loading ${tabName} data:`, error);
                showError(`Failed to load ${tabName} data. Using sample data.`);
                
                // Load sample data as fallback
                loadSampleTabData(tabName);
                updateTabUI(tabName);
            } finally {
                hideLoading();
                updateLastUpdateTime();
            }
        }
        
        function updateTabUI(tabName) {
            // Update stats cards
            updateStatsCards(tabName);
            
            // Update charts
            updateCharts(tabName);
        }
        
        // ==============================================
        // DATA LOADING FUNCTIONS FOR EACH TAB
        // ==============================================
        
        async function loadOverviewData() {
            try {
                const [dashboardRes, statisticsRes] = await Promise.all([
                    fetchWithAuth(API_ENDPOINTS.dashboard),
                    fetchWithAuth(API_ENDPOINTS.statistics)
                ]);
                
                tabData.overview = {};
                
                if (dashboardRes && dashboardRes.data) {
                    tabData.overview = {
                        ...dashboardRes.data,
                        charts: dashboardRes.data.charts || getDefaultCharts('overview')
                    };
                }
                
                if (statisticsRes && statisticsRes.data) {
                    tabData.overview = {
                        ...tabData.overview,
                        ...statisticsRes.data
                    };
                }
                
                // Ensure we have default data if empty
                if (Object.keys(tabData.overview).length === 0) {
                    tabData.overview = getDefaultOverviewData();
                }
                
            } catch (error) {
                console.error('Error loading overview data:', error);
                tabData.overview = getDefaultOverviewData();
            }
        }
        
        async function loadPoliciesData() {
            try {
                const policiesRes = await fetchWithAuth(API_ENDPOINTS.policies);
                
                if (policiesRes && policiesRes.data) {
                    tabData.policies = policiesRes.data;
                } else {
                    tabData.policies = getDefaultPoliciesData();
                }
                
            } catch (error) {
                console.error('Error loading policies data:', error);
                tabData.policies = getDefaultPoliciesData();
            }
        }
        
        async function loadClientsData() {
            try {
                const clientsRes = await fetchWithAuth(API_ENDPOINTS.clients);
                
                if (clientsRes && clientsRes.data) {
                    tabData.clients = clientsRes.data;
                } else {
                    tabData.clients = getDefaultClientsData();
                }
                
            } catch (error) {
                console.error('Error loading clients data:', error);
                tabData.clients = getDefaultClientsData();
            }
        }
        
        async function loadClaimsData() {
            try {
                const claimsRes = await fetchWithAuth(API_ENDPOINTS.claims);
                
                if (claimsRes && claimsRes.data) {
                    tabData.claims = claimsRes.data;
                } else {
                    tabData.claims = getDefaultClaimsData();
                }
                
            } catch (error) {
                console.error('Error loading claims data:', error);
                tabData.claims = getDefaultClaimsData();
            }
        }
        
        async function loadFinancialData() {
            try {
                const financialRes = await fetchWithAuth(API_ENDPOINTS.financial);
                
                if (financialRes && financialRes.data) {
                    tabData.financial = financialRes.data;
                } else {
                    tabData.financial = getDefaultFinancialData();
                }
                
            } catch (error) {
                console.error('Error loading financial data:', error);
                tabData.financial = getDefaultFinancialData();
            }
        }
        
        async function loadPerformanceData() {
            try {
                const performanceRes = await fetchWithAuth(API_ENDPOINTS.performance);
                
                if (performanceRes && performanceRes.data) {
                    tabData.performance = performanceRes.data;
                } else {
                    tabData.performance = getDefaultPerformanceData();
                }
                
            } catch (error) {
                console.error('Error loading performance data:', error);
                tabData.performance = getDefaultPerformanceData();
            }
        }
        
        // ==============================================
        // DEFAULT DATA FUNCTIONS
        // ==============================================
        
        function getDefaultOverviewData() {
            return {
                totalPolicies: 245,
                totalClients: 189,
                pendingClaims: 23,
                totalPremium: 1854300,
                policiesGrowth: 12.5,
                clientsGrowth: 8.3,
                claimsChange: -5.2,
                premiumGrowth: 15.7,
                charts: getDefaultCharts('overview')
            };
        }
        
        function getDefaultPoliciesData() {
            return {
                totalPolicies: 245,
                activePolicies: 198,
                expiredPolicies: 32,
                pendingPolicies: 15,
                policiesGrowth: 12.5,
                averagePremium: 1250,
                totalPremium: 306250,
                topPolicyType: 'Health Insurance',
                charts: getDefaultCharts('policies')
            };
        }
        
        function getDefaultClientsData() {
            return {
                totalClients: 189,
                newClients: 25,
                activeClients: 165,
                inactiveClients: 24,
                clientsGrowth: 8.3,
                averageAge: 42,
                retentionRate: 92.5,
                topClientType: 'Corporate',
                charts: getDefaultCharts('clients')
            };
        }
        
        function getDefaultClaimsData() {
            return {
                totalClaims: 48,
                pendingClaims: 8,
                approvedClaims: 25,
                rejectedClaims: 5,
                claimsChange: -5.2,
                averageClaimAmount: 5250,
                totalClaimAmount: 252000,
                topClaimType: 'Auto Insurance',
                charts: getDefaultCharts('claims')
            };
        }
        
        function getDefaultFinancialData() {
            return {
                totalRevenue: 1854300,
                totalExpenses: 1250800,
                netProfit: 603500,
                revenueGrowth: 15.7,
                expenseGrowth: 12.3,
                profitMargin: 32.5,
                cashFlow: 452300,
                topRevenueSource: 'Premium Payments',
                charts: getDefaultCharts('financial')
            };
        }
        
        function getDefaultPerformanceData() {
            return {
                customerSatisfaction: 94.2,
                processingTime: 3.2,
                claimApprovalRate: 86.5,
                policyRenewalRate: 88.7,
                efficiencyScore: 92.1,
                productivityGrowth: 12.8,
                errorRate: 2.3,
                teamPerformance: 95.4,
                charts: getDefaultCharts('performance')
            };
        }
        
        function getDefaultCharts(tabName) {
            const charts = {
                overview: {
                    policyStatus: [65, 15, 10, 10],
                    claimsTrend: [12, 19, 15, 25, 22, 30, 28, 35, 32, 40, 38, 45],
                    revenueSources: [45, 30, 25, 40, 15]
                },
                policies: {
                    policyStatus: [65, 15, 10, 10],
                    policyTypes: [30, 25, 20, 15, 10],
                    monthlyTrend: [45, 52, 48, 61, 58, 65, 62, 70, 68, 75, 72, 80]
                },
                clients: {
                    clientStatus: [85, 10, 5],
                    ageGroups: [25, 45, 65, 85, 105, 15],
                    acquisitionSources: [40, 25, 20, 15]
                },
                claims: {
                    claimStatus: [16.7, 10.4, 31.3, 12.5, 10.4, 8.3, 10.4, 6.3],
                    claimTypes: [25, 31.3, 16.7, 10.4, 8.3, 6.3, 2.1],
                    monthlyTrend: [12, 19, 15, 25, 22, 30, 28, 35, 32, 40, 38, 45]
                },
                financial: {
                    revenueSources: [45, 30, 25, 40, 15],
                    expenseBreakdown: [35, 25, 20, 15, 5],
                    profitTrend: [25, 28, 30, 32, 35, 38, 40, 42, 45, 48, 50, 52]
                },
                performance: {
                    kpiTrend: [85, 87, 89, 91, 92, 93, 94, 95, 94, 95, 96, 97],
                    teamPerformance: [88, 92, 85, 96, 90, 94, 89],
                    efficiencyTrend: [75, 78, 82, 85, 87, 89, 91, 92]
                }
            };
            
            return charts[tabName] || charts.overview;
        }
        
        function loadSampleTabData(tabName) {
            // Load sample data for each tab
            switch(tabName) {
                case 'overview':
                    tabData.overview = getDefaultOverviewData();
                    break;
                case 'policies':
                    tabData.policies = getDefaultPoliciesData();
                    break;
                case 'clients':
                    tabData.clients = getDefaultClientsData();
                    break;
                case 'claims':
                    tabData.claims = getDefaultClaimsData();
                    break;
                case 'financial':
                    tabData.financial = getDefaultFinancialData();
                    break;
                case 'performance':
                    tabData.performance = getDefaultPerformanceData();
                    break;
            }
        }
        
        // ==============================================
        // EXPORT FUNCTIONS
        // ==============================================
        
        function exportCurrentReport() {
            showLoading();
            setTimeout(() => {
                const dataStr = JSON.stringify({
                    tab: currentTab,
                    data: tabData[currentTab],
                    timestamp: new Date().toISOString(),
                    user: currentUser.username || 'admin'
                }, null, 2);
                
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `gibsysnet-${currentTab}-report-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                hideLoading();
                showSuccess(`${currentTab} report exported successfully!`);
            }, 1500);
        }
        
        function exportPoliciesReport() {
            // This function is kept for compatibility with the HTML
            exportCurrentReport();
        }
        
        // ==============================================
        // STATS CARDS MANAGEMENT
        // ==============================================
        
        function updateStatsCards(tabName) {
            const container = document.getElementById('statsCardsContainer');
            const data = tabData[tabName] || {};
            
            let cardsHTML = '';
            
            switch(tabName) {
                case 'overview':
                    cardsHTML = `
                        <!-- Total Policies -->
                        <div class="glass-card stat-card-blue rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Policies</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.totalPolicies || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-file-contract text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.policiesGrowth || 0}% this month
                            </p>
                        </div>
                        
                        <!-- Active Clients -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Active Clients</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.totalClients || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-users text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.clientsGrowth || 0}% growth
                            </p>
                        </div>
                        
                        <!-- Pending Claims -->
                        <div class="glass-card stat-card-yellow rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Pending Claims</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.pendingClaims || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="${(data.claimsChange || 0) > 0 ? 'text-red-300' : 'text-green-300'} text-sm mt-2">
                                <i class="fas ${(data.claimsChange || 0) > 0 ? 'fa-arrow-up' : 'fa-arrow-down'} mr-1"></i> ${Math.abs(data.claimsChange || 0)}% from last week
                            </p>
                        </div>
                        
                        <!-- Total Premium -->
                        <div class="glass-card stat-card-purple rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Premium</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.totalPremium || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-money-bill-wave text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.premiumGrowth || 0}% increase
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'policies':
                    cardsHTML = `
                        <!-- Total Policies -->
                        <div class="glass-card stat-card-blue rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Policies</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.totalPolicies || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-file-contract text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.policiesGrowth || 0}% growth
                            </p>
                        </div>
                        
                        <!-- Active Policies -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Active Policies</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.activePolicies || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check-circle text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-shield-alt mr-1"></i> ${calculatePercentage(data.activePolicies, data.totalPolicies)}% active
                            </p>
                        </div>
                        
                        <!-- Average Premium -->
                        <div class="glass-card stat-card-cyan rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Average Premium</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.averagePremium || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-chart-line mr-1"></i> Per policy average
                            </p>
                        </div>
                        
                        <!-- Top Policy Type -->
                        <div class="glass-card stat-card-pink rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Top Policy Type</p>
                                    <h3 class="text-2xl font-bold mt-1">${data.topPolicyType || 'Health'}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-heartbeat text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-star mr-1"></i> Most popular
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'clients':
                    cardsHTML = `
                        <!-- Total Clients -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Clients</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.totalClients || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-users text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.clientsGrowth || 0}% growth
                            </p>
                        </div>
                        
                        <!-- New Clients -->
                        <div class="glass-card stat-card-cyan rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">New Clients</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.newClients || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-plus text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-user-check mr-1"></i> This month
                            </p>
                        </div>
                        
                        <!-- Retention Rate -->
                        <div class="glass-card stat-card-blue rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Retention Rate</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.retentionRate || 0}%</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-chart-line text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-lock mr-1"></i> Client loyalty
                            </p>
                        </div>
                        
                        <!-- Average Age -->
                        <div class="glass-card stat-card-purple rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Average Age</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.averageAge || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-clock text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-calendar-alt mr-1"></i> Years
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'claims':
                    cardsHTML = `
                        <!-- Total Claims -->
                        <div class="glass-card stat-card-yellow rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Claims</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.totalClaims || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clipboard-list text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="${(data.claimsChange || 0) > 0 ? 'text-red-300' : 'text-green-300'} text-sm mt-2">
                                <i class="fas ${(data.claimsChange || 0) > 0 ? 'fa-arrow-up' : 'fa-arrow-down'} mr-1"></i> ${Math.abs(data.claimsChange || 0)}% change
                            </p>
                        </div>
                        
                        <!-- Pending Claims -->
                        <div class="glass-card stat-card-red rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Pending Claims</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.pendingClaims || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clock text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-yellow-300 text-sm mt-2">
                                <i class="fas fa-exclamation-circle mr-1"></i> Requires attention
                            </p>
                        </div>
                        
                        <!-- Approved Claims -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Approved Claims</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.approvedClaims || 0}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check-circle text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-thumbs-up mr-1"></i> ${calculatePercentage(data.approvedClaims, data.totalClaims)}% approved
                            </p>
                        </div>
                        
                        <!-- Total Claim Amount -->
                        <div class="glass-card stat-card-purple rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Claim Amount</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.totalClaimAmount || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-chart-line mr-1"></i> Current period
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'financial':
                    cardsHTML = `
                        <!-- Total Revenue -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Revenue</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.totalRevenue || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-money-bill-wave text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-arrow-up mr-1"></i> ${data.revenueGrowth || 0}% growth
                            </p>
                        </div>
                        
                        <!-- Net Profit -->
                        <div class="glass-card stat-card-blue rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Net Profit</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.netProfit || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-chart-line text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-trend-up mr-1"></i> ${data.profitMargin || 0}% margin
                            </p>
                        </div>
                        
                        <!-- Total Expenses -->
                        <div class="glass-card stat-card-red rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Total Expenses</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.totalExpenses || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-receipt text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="${(data.expenseGrowth || 0) > 0 ? 'text-red-300' : 'text-green-300'} text-sm mt-2">
                                <i class="fas ${(data.expenseGrowth || 0) > 0 ? 'fa-arrow-up' : 'fa-arrow-down'} mr-1"></i> ${Math.abs(data.expenseGrowth || 0)}% change
                            </p>
                        </div>
                        
                        <!-- Cash Flow -->
                        <div class="glass-card stat-card-cyan rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Cash Flow</p>
                                    <h3 class="text-3xl font-bold mt-1">${formatCurrency(data.cashFlow || 0)}</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-exchange-alt text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-water mr-1"></i> Positive flow
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'performance':
                    cardsHTML = `
                        <!-- Customer Satisfaction -->
                        <div class="glass-card stat-card-green rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Customer Satisfaction</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.customerSatisfaction || 0}%</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-smile text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-thumbs-up mr-1"></i> Excellent rating
                            </p>
                        </div>
                        
                        <!-- Claim Approval Rate -->
                        <div class="glass-card stat-card-blue rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Claim Approval Rate</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.claimApprovalRate || 0}%</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check-double text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-bullseye mr-1"></i> High efficiency
                            </p>
                        </div>
                        
                        <!-- Processing Time -->
                        <div class="glass-card stat-card-cyan rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Processing Time</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.processingTime || 0}d</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clock text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-tachometer-alt mr-1"></i> Fast processing
                            </p>
                        </div>
                        
                        <!-- Efficiency Score -->
                        <div class="glass-card stat-card-purple rounded-xl shadow p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="opacity-90 text-sm">Efficiency Score</p>
                                    <h3 class="text-3xl font-bold mt-1">${data.efficiencyScore || 0}%</h3>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                    <i class="fas fa-chart-bar text-white text-xl"></i>
                                </div>
                            </div>
                            <p class="text-green-300 text-sm mt-2">
                                <i class="fas fa-rocket mr-1"></i> High performance
                            </p>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = cardsHTML;
        }
        
        // ==============================================
        // CHARTS MANAGEMENT - DIPERBAIKI DAN DISINKRONKAN
        // ==============================================
        
        function updateCharts(tabName) {
            const container = document.getElementById('chartsContainer');
            const data = tabData[tabName] || {};
            const chartsData = data.charts || getDefaultCharts(tabName);
            
            let chartsHTML = '';
            
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart && chart.destroy) {
                    chart.destroy();
                }
            });
            charts = {};
            
            switch(tabName) {
                case 'overview':
                    chartsHTML = `
                        <!-- Policy Status Distribution -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold text-gray-800">Policy Status Distribution</h3>
                                <div class="relative">
                                    <button onclick="toggleChartMenu('policyChart')" class="p-2 rounded hover:bg-gray-100">
                                        <i class="fas fa-ellipsis-h text-gray-600"></i>
                                    </button>
                                    <div id="policyChartMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border py-2 z-50 hidden">
                                        <button onclick="downloadChart('policyChart')" class="w-full text-left px-4 py-2 hover:bg-gray-100">Download Chart</button>
                                        <button onclick="toggleChartType('policyChart')" class="w-full text-left px-4 py-2 hover:bg-gray-100">Switch View</button>
                                    </div>
                                </div>
                            </div>
                            <div class="h-64">
                                <canvas id="policyChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Monthly Claims Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold text-gray-800">Monthly Claims Trend</h3>
                                <div class="relative">
                                    <button onclick="toggleChartMenu('claimsChart')" class="p-2 rounded hover:bg-gray-100">
                                        <i class="fas fa-ellipsis-h text-gray-600"></i>
                                    </button>
                                    <div id="claimsChartMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border py-2 z-50 hidden">
                                        <button onclick="downloadChart('claimsChart')" class="w-full text-left px-4 py-2 hover:bg-gray-100">Download Chart</button>
                                        <button onclick="toggleChartType('claimsChart')" class="w-full text-left px-4 py-2 hover:bg-gray-100">Switch View</button>
                                    </div>
                                </div>
                            </div>
                            <div class="h-64">
                                <canvas id="claimsChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Revenue by Policy Type -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Revenue by Policy Type</h3>
                            <div class="h-64">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'policies':
                    chartsHTML = `
                        <!-- Policy Status Distribution -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Policy Status</h3>
                            <div class="h-64">
                                <canvas id="policyStatusChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Policy Types Distribution -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Policy Types</h3>
                            <div class="h-64">
                                <canvas id="policyTypesChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Monthly Policy Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Monthly Policy Trend</h3>
                            <div class="h-64">
                                <canvas id="policyTrendChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'clients':
                    chartsHTML = `
                        <!-- Client Status Distribution -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Client Status</h3>
                            <div class="h-64">
                                <canvas id="clientStatusChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Age Groups -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Age Groups</h3>
                            <div class="h-64">
                                <canvas id="ageGroupsChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Acquisition Sources -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Acquisition Sources</h3>
                            <div class="h-64">
                                <canvas id="acquisitionChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'claims':
                    chartsHTML = `
                        <!-- Claim Status Distribution -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Claim Status</h3>
                            <div class="h-64">
                                <canvas id="claimStatusChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Claim Types -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Claim Types</h3>
                            <div class="h-64">
                                <canvas id="claimTypesChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Monthly Claims Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Monthly Claims Trend</h3>
                            <div class="h-64">
                                <canvas id="claimsTrendChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'financial':
                    chartsHTML = `
                        <!-- Revenue Sources -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Revenue Sources</h3>
                            <div class="h-64">
                                <canvas id="revenueSourcesChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Expense Breakdown -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Expense Breakdown</h3>
                            <div class="h-64">
                                <canvas id="expenseChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Profit Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Profit Trend</h3>
                            <div class="h-64">
                                <canvas id="profitTrendChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'performance':
                    chartsHTML = `
                        <!-- KPI Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">KPI Trend</h3>
                            <div class="h-64">
                                <canvas id="kpiTrendChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Team Performance -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Team Performance</h3>
                            <div class="h-64">
                                <canvas id="teamPerformanceChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Efficiency Trend -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Efficiency Trend</h3>
                            <div class="h-64">
                                <canvas id="efficiencyTrendChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = chartsHTML;
            
            // Initialize charts after HTML is rendered
            setTimeout(() => {
                initializeTabCharts(tabName, chartsData);
            }, 100);
        }
        
        function initializeTabCharts(tabName, chartsData) {
            const monthLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            switch(tabName) {
                case 'overview':
                    initializeOverviewCharts(chartsData, monthLabels);
                    break;
                case 'policies':
                    initializePoliciesCharts(chartsData, monthLabels);
                    break;
                case 'clients':
                    initializeClientsCharts(chartsData);
                    break;
                case 'claims':
                    initializeClaimsCharts(chartsData, monthLabels);
                    break;
                case 'financial':
                    initializeFinancialCharts(chartsData, monthLabels);
                    break;
                case 'performance':
                    initializePerformanceCharts(chartsData, monthLabels);
                    break;
            }
        }
        
        function initializeOverviewCharts(chartsData, monthLabels) {
            // Policy Status Chart
            const policyCtx = document.getElementById('policyChart');
            if (policyCtx) {
                charts.policyChart = new Chart(policyCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Active', 'Pending', 'Expired', 'Cancelled'],
                        datasets: [{
                            data: chartsData.policyStatus || [65, 15, 10, 10],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(156, 163, 175, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: 'white'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Claims Trend Chart
            const claimsCtx = document.getElementById('claimsChart');
            if (claimsCtx) {
                charts.claimsChart = new Chart(claimsCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: 'Claims Count',
                            data: chartsData.claimsTrend || [12, 19, 15, 25, 22, 30, 28, 35, 32, 40, 38, 45],
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    drawBorder: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                charts.revenueChart = new Chart(revenueCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Property', 'Vehicle', 'Health', 'Life', 'Travel'],
                        datasets: [{
                            label: 'Revenue (in thousands)',
                            data: chartsData.revenueSources || [45, 30, 25, 40, 15],
                            backgroundColor: [
                                'rgba(37, 99, 235, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)'
                            ],
                            borderRadius: 6,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    drawBorder: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initializePoliciesCharts(chartsData, monthLabels) {
            // Policy Status Chart
            const policyStatusCtx = document.getElementById('policyStatusChart');
            if (policyStatusCtx) {
                charts.policyStatusChart = new Chart(policyStatusCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Active', 'Pending', 'Expired', 'Cancelled'],
                        datasets: [{
                            data: chartsData.policyStatus || [65, 15, 10, 10],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(156, 163, 175, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            // Policy Types Chart
            const policyTypesCtx = document.getElementById('policyTypesChart');
            if (policyTypesCtx) {
                charts.policyTypesChart = new Chart(policyTypesCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Health', 'Auto', 'Property', 'Life', 'Travel'],
                        datasets: [{
                            label: 'Policy Count',
                            data: chartsData.policyTypes || [30, 25, 20, 15, 10],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Policy Trend Chart
            const policyTrendCtx = document.getElementById('policyTrendChart');
            if (policyTrendCtx) {
                charts.policyTrendChart = new Chart(policyTrendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: 'Policies',
                            data: chartsData.monthlyTrend || [45, 52, 48, 61, 58, 65, 62, 70, 68, 75, 72, 80],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }
        
        function initializeClientsCharts(chartsData) {
            // Initialize client charts...
            const clientStatusCtx = document.getElementById('clientStatusChart');
            if (clientStatusCtx) {
                charts.clientStatusChart = new Chart(clientStatusCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Active', 'Inactive', 'New'],
                        datasets: [{
                            data: chartsData.clientStatus || [85, 10, 5],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(59, 130, 246, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            // Similar implementation for other client charts...
        }
        
        function initializeClaimsCharts(chartsData, monthLabels) {
            // Initialize claims charts...
            const claimStatusCtx = document.getElementById('claimStatusChart');
            if (claimStatusCtx) {
                charts.claimStatusChart = new Chart(claimStatusCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Pending', 'Submitted', 'Review', 'Approved', 'Rejected', 'Processing', 'Paid', 'Closed'],
                        datasets: [{
                            data: chartsData.claimStatus || [16.7, 10.4, 31.3, 12.5, 10.4, 8.3, 10.4, 6.3],
                            backgroundColor: [
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(6, 182, 212, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(156, 163, 175, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
            
            // Similar implementation for other claims charts...
        }
        
        function initializeFinancialCharts(chartsData, monthLabels) {
            // Initialize financial charts...
            const revenueSourcesCtx = document.getElementById('revenueSourcesChart');
            if (revenueSourcesCtx) {
                charts.revenueSourcesChart = new Chart(revenueSourcesCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Premiums', 'Investments', 'Services', 'Commissions', 'Other'],
                        datasets: [{
                            label: 'Revenue (in thousands)',
                            data: chartsData.revenueSources || [45, 30, 25, 40, 15],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(156, 163, 175, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }
        
        function initializePerformanceCharts(chartsData, monthLabels) {
            // Initialize performance charts...
            const kpiTrendCtx = document.getElementById('kpiTrendChart');
            if (kpiTrendCtx) {
                charts.kpiTrendChart = new Chart(kpiTrendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: 'KPI Score (%)',
                            data: chartsData.kpiTrend || [85, 87, 89, 91, 92, 93, 94, 95, 94, 95, 96, 97],
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                min: 80,
                                max: 100
                            }
                        }
                    }
                });
            }
        }
        
        // ==============================================
        // CHART UTILITY FUNCTIONS
        // ==============================================
        
        function toggleChartMenu(chartId) {
            const menu = document.getElementById(chartId + 'Menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        function downloadChart(chartId) {
            const chart = charts[chartId];
            if (chart) {
                const link = document.createElement('a');
                link.download = `${chartId}-${new Date().toISOString().split('T')[0]}.png`;
                link.href = chart.toBase64Image();
                link.click();
                showSuccess('Chart downloaded successfully!');
            }
        }
        
        function toggleChartType(chartId) {
            const chart = charts[chartId];
            if (chart) {
                const currentType = chart.config.type;
                let newType;
                
                switch(currentType) {
                    case 'bar':
                        newType = 'line';
                        break;
                    case 'line':
                        newType = 'doughnut';
                        break;
                    case 'doughnut':
                        newType = 'pie';
                        break;
                    case 'pie':
                        newType = 'bar';
                        break;
                    default:
                        newType = 'bar';
                }
                
                chart.config.type = newType;
                chart.update();
                showSuccess(`Switched to ${newType} chart`);
            }
        }
        
        // ==============================================
        // HELPER FUNCTIONS
        // ==============================================
        
        function calculatePercentage(part, total) {
            if (!total || total === 0) return 0;
            return Math.round((part / total) * 100);
        }
        
        function formatCurrency(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toFixed(0);
        }
        
        // ==============================================
        // USER DATA MANAGEMENT
        // ==============================================
        
        function loadUserData() {
            const gibsysnetUser = localStorage.getItem('gibsysnet_user');
            
            if (gibsysnetUser) {
                try {
                    currentUser = JSON.parse(gibsysnetUser);
                } catch (error) {
                    currentUser = getDefaultUser();
                }
            } else {
                currentUser = getDefaultUser();
            }
            
            updateUserProfile();
        }
        
        function getDefaultUser() {
            return {
                username: 'superadmin',
                full_name: 'Super Administrator',
                user_level: 'super_admin',
                email: 'superadmin@gibsysnet.com',
                badge_text: 'Super Admin'
            };
        }
        
        function updateUserProfile() {
            const userNameEl = document.getElementById('userName');
            const userRoleEl = document.getElementById('userRole');
            const userEmailEl = document.getElementById('userEmail');
            const userInitialsEl = document.getElementById('userInitials');
            const userAvatarEl = document.getElementById('userAvatar');
            const welcomeMessageEl = document.getElementById('welcomeMessage');
            
            if (currentUser.full_name) {
                userNameEl.textContent = currentUser.full_name;
            }
            
            if (currentUser.badge_text) {
                userRoleEl.textContent = currentUser.badge_text;
            }
            
            if (currentUser.email) {
                userEmailEl.textContent = currentUser.email;
            }
            
            // Set user initials
            let initials = 'U';
            if (currentUser.full_name) {
                const nameParts = currentUser.full_name.split(' ');
                if (nameParts.length >= 2) {
                    initials = (nameParts[0][0] + nameParts[1][0]).toUpperCase();
                } else {
                    initials = currentUser.full_name.substring(0, 2).toUpperCase();
                }
            }
            userInitialsEl.textContent = initials;
            
            // Update welcome message
            if (welcomeMessageEl) {
                welcomeMessageEl.textContent = `Welcome back, ${userNameEl.textContent}! Real-time insights and comprehensive reporting`;
            }
        }
        
        // ==============================================
        // AUTHENTICATION & SECURITY
        // ==============================================
        function checkAuth() {
            const token = localStorage.getItem('gibsysnet_token');
            const user = localStorage.getItem('gibsysnet_user');
            
            if (!token || !user) {
                console.warn('No authentication found.');
                // Redirect to login if needed
                // window.location.href = '../login.html';
                // return false;
            }
            
            console.log('Authentication check passed');
            return true;
        }
        
        async function fetchWithAuth(url, options = {}) {
            const token = localStorage.getItem('gibsysnet_token');
            
            const defaultOptions = {
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                },
                mode: 'cors'
            };
            
            const finalOptions = { ...defaultOptions, ...options };
            
            try {
                const response = await fetch(url, finalOptions);
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '../login.html';
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.warn('API Error:', error.message);
                return null;
            }
        }
        
        // ==============================================
        // ACTIVITIES MANAGEMENT
        // ==============================================
        
        const SAMPLE_ACTIVITIES = [
            { id: 1, type: 'policy', action: 'New policy created', user: 'John Smith', time: '2 minutes ago', icon: 'file-contract', color: 'primary' },
            { id: 2, type: 'claim', action: 'Claim approved', user: 'Sarah Johnson', time: '15 minutes ago', icon: 'check-circle', color: 'success' },
            { id: 3, type: 'client', action: 'Client registered', user: 'Mike Wilson', time: '1 hour ago', icon: 'user-plus', color: 'info' },
            { id: 4, type: 'system', action: 'System backup completed', user: 'System', time: '2 hours ago', icon: 'database', color: 'secondary' },
            { id: 5, type: 'alert', action: 'Policy expiration warning', user: 'System', time: '3 hours ago', icon: 'exclamation-triangle', color: 'warning' }
        ];
        
        async function loadActivities() {
            try {
                const response = await fetchWithAuth(API_ENDPOINTS.activities);
                const activities = response && response.data ? response.data : SAMPLE_ACTIVITIES;
                renderActivities(activities);
            } catch (error) {
                console.error('Error loading activities:', error);
                renderActivities(SAMPLE_ACTIVITIES);
            }
        }
        
        function renderActivities(activities) {
            const container = document.getElementById('activityList');
            if (!container) return;
            
            container.innerHTML = activities.map(activity => `
                <div class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="w-10 h-10 ${getActivityColor(activity.color)} rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-${activity.icon}"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${activity.action}</p>
                        <p class="text-sm text-gray-500">By ${activity.user}</p>
                    </div>
                    <span class="text-sm text-gray-500">${activity.time}</span>
                </div>
            `).join('');
        }
        
        function getActivityColor(color) {
            switch(color) {
                case 'primary': return 'bg-blue-100 text-blue-600';
                case 'success': return 'bg-green-100 text-green-600';
                case 'info': return 'bg-blue-100 text-blue-600';
                case 'secondary': return 'bg-gray-100 text-gray-600';
                case 'warning': return 'bg-yellow-100 text-yellow-600';
                default: return 'bg-gray-100 text-gray-600';
            }
        }
        
        // ==============================================
        // TIME FILTER MANAGEMENT
        // ==============================================
        
        function setTimeFilter(filter) {
            currentTimeFilter = filter;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-50', 'border-blue-200', 'text-blue-600');
                btn.classList.add('text-gray-700');
            });
            event.target.classList.add('active', 'bg-blue-50', 'border-blue-200', 'text-blue-600');
            
            // Update display
            const filterMap = {
                'today': 'Today',
                'week': 'This Week',
                'month': 'This Month',
                'quarter': 'This Quarter',
                'year': 'This Year'
            };
            
            document.getElementById('currentFilterDisplay').textContent = filterMap[filter];
            
            // Reload current tab data with new filter
            loadTabData(currentTab);
        }
        
        // ==============================================
        // ACTION FUNCTIONS
        // ==============================================
        
        function refreshDashboard() {
            showLoading();
            setTimeout(() => {
                loadTabData(currentTab);
                loadActivities();
                showSuccess('Dashboard refreshed successfully!');
            }, 1000);
        }
        
        function exportDashboard() {
            showLoading();
            setTimeout(() => {
                const dataStr = JSON.stringify({
                    statistics: tabData[currentTab],
                    timestamp: new Date().toISOString()
                }, null, 2);
                
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `gibsysnet-dashboard-${currentTab}-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                hideLoading();
                showSuccess(`${currentTab} data exported successfully!`);
            }, 1500);
        }
        
        function exportAsPDF() {
            showToast('PDF export feature coming soon!', 'info');
        }
        
        function exportAsExcel() {
            showToast('Excel export feature coming soon!', 'info');
        }
        
        function scheduleReport() {
            showToast('Report scheduling feature coming soon!', 'info');
        }
        
        function openRiskAnalysis() {
            window.open('risk-analysis.html', '_blank');
        }
        
        function openPerformanceMetrics() {
            window.open('performance-metrics.html', '_blank');
        }
        
        function openPredictiveInsights() {
            window.open('predictive-insights.html', '_blank');
        }
        
        function generatePerformanceReport() {
            window.open('performance-report.html', '_blank');
        }
        
        function openAlertCenter() {
            showToast('Alert center would open here.', 'info');
        }
        
        function loadMoreActivities() {
            // Simulate loading more activities
            const newActivities = [
                { id: 6, type: 'payment', action: 'Premium payment received', user: 'Emma Davis', time: '4 hours ago', icon: 'credit-card', color: 'success' },
                { id: 7, type: 'renewal', action: 'Policy renewal reminder sent', user: 'System', time: '5 hours ago', icon: 'envelope', color: 'info' }
            ];
            
            const container = document.getElementById('activityList');
            newActivities.forEach(activity => {
                const activityHTML = `
                    <div class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                        <div class="w-10 h-10 ${getActivityColor(activity.color)} rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-${activity.icon}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">${activity.action}</p>
                            <p class="text-sm text-gray-500">By ${activity.user}</p>
                        </div>
                        <span class="text-sm text-gray-500">${activity.time}</span>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', activityHTML);
            });
            
            showSuccess('More activities loaded!');
        }
        
        function openNotifications() {
            showToast('Notifications modal would open here.', 'info');
        }
        
        // ==============================================
        // UTILITY FUNCTIONS
        // ==============================================
        
        function showLoading() {
            let overlay = document.getElementById('loadingOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'loadingOverlay';
                overlay.className = 'fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50';
                overlay.innerHTML = `
                    <div class="text-center">
                        <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"></div>
                        <p class="mt-4 text-gray-600">Loading dashboard data...</p>
                    </div>
                `;
                document.body.appendChild(overlay);
            }
            overlay.style.display = 'flex';
        }
        
        function hideLoading() {
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
            }, 500);
        }
        
        function showError(message) {
            showToast(message, 'error');
        }
        
        function showSuccess(message) {
            showToast(message, 'success');
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 transform translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-green-600' :
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            
            const icon = type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${icon} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // ==============================================
        // SETUP FUNCTIONS
        // ==============================================
        
        function setupAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            autoRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing dashboard data...');
                loadTabData(currentTab);
            }, 5 * 60 * 1000);
        }
        
        function setupEventListeners() {
            // Resize charts on window resize
            window.addEventListener('resize', function() {
                Object.values(charts).forEach(chart => {
                    if (chart && chart.resize) chart.resize();
                });
            });
            
            // Close export menu when clicking outside
            document.addEventListener('click', function(event) {
                const menu = document.getElementById('exportMenu');
                const button = document.querySelector('[onclick="toggleExportMenu()"]');
                
                if (menu && !menu.contains(event.target) && button && !button.contains(event.target)) {
                    menu.classList.add('hidden');
                }
                
                // Close chart menus
                document.querySelectorAll('[id$="Menu"]').forEach(menu => {
                    if (menu.id.includes('Chart') && !menu.contains(event.target)) {
                        menu.classList.add('hidden');
                    }
                });
            });
            
            // Search functionality
            const searchInput = document.getElementById('searchReports');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    console.log('Searching for:', searchTerm);
                    // Implement search functionality here
                });
            }
        }
        
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.classList.toggle('hidden');
        }
        
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const icon = document.getElementById('sidebarToggleIcon');
            
            sidebar.classList.toggle('collapsed');
            
            if (sidebar.classList.contains('collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        }
        
        function initializeDateTime() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }
        
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('en-US', dateOptions);
        }
        
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdateTime').textContent = timeString;
        }
        
        function updateSyncTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const lastSyncElement = document.getElementById('lastSync');
            if (lastSyncElement) {
                lastSyncElement.textContent = `Last synced: ${timeStr}`;
            }
        }
        
        // Initialize sync time update
        setInterval(updateSyncTime, 60000);
        
        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showError('An unexpected error occurred');
        });
    </script>
</body>
</html>